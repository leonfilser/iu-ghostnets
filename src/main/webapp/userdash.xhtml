<?xml version='1.0' encoding='UTF-8' ?>

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

    <h:head>
        <title>Shea Shepherd</title>
        <link rel="icon" type="image/x-icon" href="media/favicon.ico" />
        <link rel="stylesheet" type="text/css" media="screen" href="style.css"/>
    </h:head>

    <h:body>
        <div class="main-container">

            <!-- Logo and Home Button -->
            <a href="index.xhtml">
                <img class="header-logo" src="media/logo.png" alt="Shea Shepherd Logo"/>
            </a>

            <!-- User Dashboard for Logged-in Users -->
            <h:panelGroup rendered="#{sessionHandler.loggedIn}">

                <div class="userdash-welcome">
                    <p:button class="secondary-button" value="Home" outcome="index"/>

                    <h2>
                        <h:outputText value="Willkommen #{userController.user.firstName} #{userController.user.lastName}!" />
                    </h2>

                    <h:form>
                        <p:commandButton class="primary-button" value="Ausloggen" action="#{userController.logoutUser}" />
                    </h:form>
                </div>

                <!-- User's Ghostnets -->
                <h2 class="home-subtitle">Ihre Geisternetze</h2>

                <h:form id="ghostnetTable">
                    <p:dataTable value="#{ghostnetController.getGhostnetsByLoggedinUser()}" lazy="false" var="singleGhostnetItem"
                                 sortOrder="ascending" sortBy="#{singleGhostnetItem.sightingDate}" rows="5"
                                 paginator="true" paginatorPosition="bottom">
                        
                        <p:column headerText="Sichtung" width="10%" sortBy="#{singleGhostnetItem.sightingDate}">
                            <h:outputText value="#{singleGhostnetItem.sightingDate}">
                                <f:convertDateTime pattern="dd.MM.yyyy" />
                            </h:outputText>
                        </p:column>

                        <p:column headerText="Größe" width="10%" sortBy="#{singleGhostnetItem.size}">
                            <h:outputText value="#{singleGhostnetItem.size} m²" />
                        </p:column>

                        <p:column headerText="Status" width="20%" sortBy="#{singleGhostnetItem.currentState}">
                            <span class="currentState state-#{singleGhostnetItem.currentState}">
                                #{singleGhostnetItem.currentState.displayName}
                            </span>
                        </p:column>
                        
                        <p:column headerText="Koordinaten" width="15%">
                            <p:button class="primary-button small-button" value="Auf Maps ansehen"
                                      onclick="window.open('https://maps.google.com/?q=#{singleGhostnetItem.latitude},#{singleGhostnetItem.longitude}', '_blank')" />
                        </p:column>

                        <p:column headerText="Aktion" width="45%">
                            <p:commandButton class="small-button ghostnet-retrieved" value="Geisternetz geborgen"
                                             icon="pi pi-check" iconPos="right"
                                             action="#{ghostnetController.finishRetrievalOfGhostnet(singleGhostnetItem)}"
                                             ajax="true" update="ghostnetTable"/>
                            <p:commandButton class="small-button contact-reporter" value="Melder kontaktieren"
                                             icon="pi pi-times" iconPos="right"
                                             action="#{ghostnetController.abortRetrievalOfGhostnet(singleGhostnetItem)}"
                                             ajax="true" update="ghostnetTable"/>
                            <p:commandButton class="small-button abort-retrieval" value="Bergung abbrechen"
                                             icon="pi pi-times" iconPos="right"
                                             action="#{ghostnetController.abortRetrievalOfGhostnet(singleGhostnetItem)}"
                                             ajax="true" update="ghostnetTable"/>
                            <p:commandButton class="small-button mark-lost" value="Als verschollen markieren"
                                             icon="pi pi-flag" iconPos="right"
                                             action="#{ghostnetController.markGhostnetAsLost(singleGhostnetItem)}"
                                             ajax="true" update="ghostnetTable"/>
                        </p:column>
                    </p:dataTable>

                    <!-- Other Ghostnets -->
                    <h2 class="home-subtitle">Nicht geborgen</h2>

                    <p:dataTable value="#{ghostnetController.getAllOtherGhostnets()}" lazy="false" var="singleGhostnetItem"
                                 sortOrder="ascending" sortBy="#{singleGhostnetItem.sightingDate}" rows="5"
                                 paginator="true" paginatorPosition="bottom">

                        <p:column headerText="Sichtung" width="10%" sortBy="#{singleGhostnetItem.sightingDate}">
                            <h:outputText value="#{singleGhostnetItem.sightingDate}">
                                <f:convertDateTime pattern="dd.MM.yyyy" />
                            </h:outputText>
                        </p:column>

                        <p:column headerText="Größe" width="10%" sortBy="#{singleGhostnetItem.size}">
                            <h:outputText value="#{singleGhostnetItem.size} m²" />
                        </p:column>

                        <p:column headerText="Status" width="20%" sortBy="#{singleGhostnetItem.currentState}">
                            <span class="currentState state-#{singleGhostnetItem.currentState}">
                                #{singleGhostnetItem.currentState.displayName}
                            </span>
                        </p:column>

                        <p:column headerText="Koordinaten" width="15%">
                            <p:button class="primary-button small-button" value="Auf Maps ansehen"
                                      onclick="window.open('https://maps.google.com/?q=#{singleGhostnetItem.latitude},#{singleGhostnetItem.longitude}', '_blank')" />
                        </p:column>

                        <p:column headerText="Aktion" width="45%">
                            <p:commandButton class="small-button ghostnet-retrieved" value="Geisternetz bergen"
                                             action="#{ghostnetController.startRetrievalOfGhostnet(singleGhostnetItem)}"
                                             ajax="true" update="ghostnetTable"/>
                            <p:commandButton class="small-button contact-reporter" value="Bergenden anrufen"
                                             action="#{ghostnetController.markGhostnetAsLost(singleGhostnetItem)}"
                                             ajax="true" update="ghostnetTable"/>
                            <p:commandButton class="small-button mark-lost"
                                             action="#{ghostnetController.markGhostnetAsLost(singleGhostnetItem)}"
                                             ajax="true" update="ghostnetTable"/>
                        </p:column>
                    </p:dataTable>
                </h:form>
            </h:panelGroup>

            <!-- Message for Non-Logged-in Users -->
            <h:panelGroup rendered="#{!sessionHandler.loggedIn}">
                <h2>
                    <h:outputText value="Bitte loggen Sie sich ein, um auf diese Seite zuzugreifen." />
                </h2>
                <p:button class="secondary-button" value="Einloggen/Registrieren" outcome="userauth"/>
            </h:panelGroup>
        </div>
    </h:body>
</html>